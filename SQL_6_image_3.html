<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEFT JOINの実用例</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .title {
            text-align: center;
            color: #2c3e50;
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #00b894;
        }
        .example-section {
            margin-bottom: 40px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border-left: 5px solid #00b894;
        }
        .example-title {
            font-size: 20px;
            font-weight: bold;
            color: #00b894;
            margin-bottom: 20px;
            padding: 10px;
            background: #e8f8f5;
            border-radius: 8px;
            text-align: center;
        }
        .scenario-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .scenario-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
        }
        .sql-box {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 15px 0;
            border-left: 4px solid #00b894;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .result-table th, .result-table td {
            border: 1px solid #e9ecef;
            padding: 10px;
            text-align: center;
        }
        .result-table th {
            background: #00b894;
            color: white;
            font-weight: bold;
        }
        .null-highlight {
            background: #f8d7da !important;
            color: #721c24;
            font-style: italic;
            font-weight: bold;
        }
        .good-score {
            background: #d4edda !important;
            color: #155724;
            font-weight: bold;
        }
        .analysis-box {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .analysis-title {
            font-weight: bold;
            color: #0c5460;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .benefit-list {
            list-style: none;
            padding-left: 0;
        }
        .benefit-list li {
            padding: 5px 0;
            padding-left: 25px;
            position: relative;
        }
        .benefit-list li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #00b894;
            font-weight: bold;
            font-size: 16px;
        }
        .comparison-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .comparison-box {
            flex: 1;
            border-radius: 10px;
            padding: 15px;
            border: 2px solid;
        }
        .without-left-join {
            border-color: #e74c3c;
            background: #ffeaea;
        }
        .with-left-join {
            border-color: #00b894;
            background: #e8f8f5;
        }
        .comparison-title {
            font-weight: bold;
            text-align: center;
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .without-left-join .comparison-title {
            background: #e74c3c;
            color: white;
        }
        .with-left-join .comparison-title {
            background: #00b894;
            color: white;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stats-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-top: 4px solid #00b894;
        }
        .stats-number {
            font-size: 24px;
            font-weight: bold;
            color: #00b894;
        }
        .stats-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .practical-tip {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 5px solid #f39c12;
        }
        .tip-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">LEFT JOIN実用例：全体状況把握と分析活用</div>

        <!-- Example 1: 全学生の成績状況確認 -->
        <div class="example-section">
            <div class="example-title">📊 実用例1：全学生の成績状況一覧</div>
            
            <div class="scenario-box">
                <div class="scenario-title">シナリオ：</div>
                教員が「クラス全体の状況を把握したい。成績がまだ入力されていない学生も含めて一覧で確認したい」
            </div>

            <div class="comparison-container">
                <div class="comparison-box without-left-join">
                    <div class="comparison-title">❌ INNER JOINの場合</div>
                    <div class="sql-box" style="font-size: 11px;">
                        SELECT s.name, COUNT(sc.id) as subjects <br>
                        FROM student s <br>
                        INNER JOIN score sc ON s.student_id = sc.student_id <br>
                        GROUP BY s.student_id;
                    </div>
                    <div style="font-size: 12px; color: #e74c3c;">
                        <strong>問題：</strong>成績未入力の学生が表示されない！
                    </div>
                </div>

                <div class="comparison-box with-left-join">
                    <div class="comparison-title">✅ LEFT JOINの場合</div>
                    <div class="sql-box" style="font-size: 11px;">
                        SELECT s.name, COUNT(sc.id) as subjects <br>
                        FROM student s <br>
                        LEFT JOIN score sc ON s.student_id = sc.student_id <br>
                        GROUP BY s.student_id;
                    </div>
                    <div style="font-size: 12px; color: #00b894;">
                        <strong>解決：</strong>全学生の状況を漏れなく確認可能！
                    </div>
                </div>
            </div>

            <div class="sql-box">
                -- 詳細な学生状況レポート（LEFT JOIN活用） <br>
                SELECT <br>
                &nbsp;&nbsp;&nbsp;&nbsp;s.student_id, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;s.name, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;s.department, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;COUNT(sc.id) as subject_count, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;ROUND(AVG(sc.score), 1) as average_score <br>
                FROM student s <br>
                LEFT JOIN score sc ON s.student_id = sc.student_id <br>
                WHERE s.status = 'active' <br>
                GROUP BY s.student_id, s.name, s.department <br>
                ORDER BY s.student_id;
            </div>

            <table class="result-table">
                <tr>
                    <th>student_id</th>
                    <th>name</th>
                    <th>department</th>
                    <th>subject_count</th>
                    <th>average_score</th>
                </tr>
                <tr>
                    <td>S001</td>
                    <td>田中太郎</td>
                    <td>情報工学部</td>
                    <td class="good-score">3</td>
                    <td class="good-score">88.3</td>
                </tr>
                <tr>
                    <td>S002</td>
                    <td>佐藤花子</td>
                    <td>経営学部</td>
                    <td class="good-score">3</td>
                    <td class="good-score">89.0</td>
                </tr>
                <tr>
                    <td>S003</td>
                    <td>山田次郎</td>
                    <td>情報工学部</td>
                    <td class="good-score">2</td>
                    <td class="good-score">91.0</td>
                </tr>
                <tr>
                    <td>S004</td>
                    <td class="null-highlight">鈴木美咲</td>
                    <td>文学部</td>
                    <td class="null-highlight">0</td>
                    <td class="null-highlight">NULL</td>
                </tr>
                <tr>
                    <td>S005</td>
                    <td>高橋健太</td>
                    <td>情報工学部</td>
                    <td class="good-score">3</td>
                    <td class="good-score">86.7</td>
                </tr>
                <tr>
                    <td>S006</td>
                    <td>伊藤麻衣</td>
                    <td>経営学部</td>
                    <td class="good-score">2</td>
                    <td class="good-score">87.5</td>
                </tr>
            </table>

            <div class="analysis-box">
                <div class="analysis-title">📈 LEFT JOINによる分析効果</div>
                <ul class="benefit-list">
                    <li><strong>鈴木美咲さん</strong>の成績未入力状況を発見</li>
                    <li>履修科目数の差（0〜3科目）を把握</li>
                    <li>学部別の履修状況を比較可能</li>
                    <li>フォローが必要な学生を特定</li>
                </ul>
            </div>
        </div>

        <!-- Example 2: 学部別統計分析 -->
        <div class="example-section">
            <div class="example-title">📈 実用例2：学部別統計分析</div>
            
            <div class="scenario-box">
                <div class="scenario-title">シナリオ：</div>
                管理者が「各学部の履修状況と成績を比較分析したい。在籍学生数と実際の履修者数の違いも知りたい」
            </div>

            <div class="sql-box">
                -- 学部別詳細統計（LEFT JOIN + 集約関数） <br>
                SELECT <br>
                &nbsp;&nbsp;&nbsp;&nbsp;s.department, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;COUNT(DISTINCT s.student_id) as total_students, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;COUNT(sc.id) as total_scores, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;COUNT(DISTINCT CASE WHEN sc.id IS NOT NULL THEN s.student_id END) as active_students, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;ROUND(AVG(sc.score), 1) as avg_score, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;MAX(sc.score) as max_score, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;MIN(sc.score) as min_score <br>
                FROM student s <br>
                LEFT JOIN score sc ON s.student_id = sc.student_id <br>
                WHERE s.status = 'active' <br>
                GROUP BY s.department <br>
                ORDER BY avg_score DESC;
            </div>

            <table class="result-table">
                <tr>
                    <th>department</th>
                    <th>total_students</th>
                    <th>total_scores</th>
                    <th>active_students</th>
                    <th>avg_score</th>
                    <th>max_score</th>
                    <th>min_score</th>
                </tr>
                <tr>
                    <td>情報工学部</td>
                    <td class="good-score">4</td>
                    <td>11</td>
                    <td class="good-score">3</td>
                    <td class="good-score">89.1</td>
                    <td>96</td>
                    <td>78</td>
                </tr>
                <tr>
                    <td>経営学部</td>
                    <td class="good-score">2</td>
                    <td>5</td>
                    <td class="good-score">2</td>
                    <td class="good-score">88.2</td>
                    <td>95</td>
                    <td>80</td>
                </tr>
                <tr>
                    <td>文学部</td>
                    <td class="null-highlight">2</td>
                    <td class="null-highlight">1</td>
                    <td class="null-highlight">1</td>
                    <td class="null-highlight">78.0</td>
                    <td>78</td>
                    <td>78</td>
                </tr>
            </table>

            <div class="stats-grid">
                <div class="stats-card">
                    <div class="stats-number">75%</div>
                    <div class="stats-label">情報工学部履修率<br>(3/4人)</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number">100%</div>
                    <div class="stats-label">経営学部履修率<br>(2/2人)</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number">50%</div>
                    <div class="stats-label">文学部履修率<br>(1/2人)</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number">1人</div>
                    <div class="stats-label">成績未入力<br>(鈴木美咲)</div>
                </div>
            </div>

            <div class="analysis-box">
                <div class="analysis-title">📊 分析結果のポイント</div>
                <ul class="benefit-list">
                    <li><strong>文学部</strong>の履修率が50%と低い → 指導強化が必要</li>
                    <li><strong>情報工学部</strong>は4人中1人未履修 → 個別フォロー対象特定</li>
                    <li><strong>経営学部</strong>は全員履修済み → 良好な状況</li>
                    <li>学部別の成績差を数値で把握 → 教育方針の見直し検討</li>
                </ul>
            </div>
        </div>

        <!-- Example 3: NULL値の活用 -->
        <div class="example-section">
            <div class="example-title">🎯 実用例3：NULL値を活用した抽出・分析</div>
            
            <div class="scenario-box">
                <div class="scenario-title">シナリオ：</div>
                「成績が未入力の学生を特定して、個別指導の対象者リストを作成したい」
            </div>

            <div class="sql-box">
                -- 成績未入力学生の抽出（NULL値の活用） <br>
                SELECT <br>
                &nbsp;&nbsp;&nbsp;&nbsp;s.student_id, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;s.name, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;s.department, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;s.email, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;DATEDIFF(CURDATE(), s.enrollment_date) as days_since_enrollment <br>
                FROM student s <br>
                LEFT JOIN score sc ON s.student_id = sc.student_id <br>
                WHERE s.status = 'active' <br>
                GROUP BY s.student_id, s.name, s.department, s.email, s.enrollment_date <br>
                HAVING COUNT(sc.id) = 0 <br>
                ORDER BY days_since_enrollment DESC;
            </div>

            <table class="result-table">
                <tr>
                    <th>student_id</th>
                    <th>name</th>
                    <th>department</th>
                    <th>email</th>
                    <th>days_since_enrollment</th>
                </tr>
                <tr>
                    <td class="null-highlight">S004</td>
                    <td class="null-highlight">鈴木美咲</td>
                    <td class="null-highlight">文学部</td>
                    <td class="null-highlight">suzuki@example.com</td>
                    <td class="null-highlight">45</td>
                </tr>
            </table>

            <div class="practical-tip">
                <div class="tip-title">💡 実務での活用テクニック</div>
                <strong>COUNT(sc.id) = 0</strong> と <strong>HAVING句</strong> の組み合わせで、LEFT JOINのNULL値を効果的に活用！
                <br><br>
                <ul class="benefit-list">
                    <li>在籍45日経過しても成績未入力 → 緊急対応が必要</li>
                    <li>連絡先メールアドレスも取得 → 即座にフォロー可能</li>
                    <li>学部情報も含む → 学部別指導方針の適用</li>
                </ul>
            </div>
        </div>

        <div class="analysis-box">
            <div class="analysis-title">🚀 Week 8への準備：Spring Boot連携での活用</div>
            <div style="background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 8px; margin: 10px 0; font-family: 'Courier New', monospace; font-size: 12px;">
                // Week 8で使用予定のMyBatis Mapper <br>
                @Select("SELECT s.name, COUNT(sc.id) as subjectCount, " + <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"AVG(sc.score) as avgScore " + <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"FROM student s " + <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"LEFT JOIN score sc ON s.student_id = sc.student_id " + <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"GROUP BY s.student_id") <br>
                List&lt;StudentSummary&gt; findAllStudentsWithScoreSummary();
            </div>
            <p>LEFT JOINによる<strong>全体状況把握</strong>のテクニックは、Spring Bootの管理画面開発で必須の技術です！</p>
        </div>
    </div>
</body>
</html>