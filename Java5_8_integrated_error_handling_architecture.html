<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>統合エラーハンドリングシステムアーキテクチャ図</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1500px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 24px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .architecture-container {
            position: relative;
            width: 100%;
            height: 1000px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* Main Layers */
        .architecture-layer {
            position: absolute;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .architecture-layer:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .controller-layer {
            top: 20px;
            left: 5%;
            right: 35%;
            height: 90px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }
        
        .service-layer {
            top: 130px;
            left: 5%;
            right: 35%;
            height: 110px;
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
        }
        
        .repository-layer {
            top: 260px;
            left: 5%;
            right: 35%;
            height: 90px;
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            color: white;
        }
        
        .infrastructure-layer {
            top: 370px;
            left: 5%;
            right: 35%;
            height: 80px;
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
            color: white;
        }
        
        /* Cross-cutting Concerns - 適切なサイズで配置 */
        .logging-system {
            position: absolute;
            right: 20px;
            top: 20px;
            width: 30%;
            height: 430px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border-radius: 12px;
            padding: 12px;
            box-sizing: border-box;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .async-system {
            position: absolute;
            left: 20px;
            top: 470px;
            width: 30%;
            height: 180px;
            background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);
            color: white;
            border-radius: 12px;
            padding: 12px;
            box-sizing: border-box;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .performance-monitor {
            position: absolute;
            left: 35%;
            top: 470px;
            width: 30%;
            height: 180px;
            background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);
            color: white;
            border-radius: 12px;
            padding: 12px;
            box-sizing: border-box;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .testing-framework {
            position: absolute;
            right: 20px;
            top: 470px;
            width: 30%;
            height: 180px;
            background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%);
            color: white;
            border-radius: 12px;
            padding: 12px;
            box-sizing: border-box;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .layer-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .layer-content {
            font-size: 14px;
            line-height: 1.4;
            opacity: 0.95;
        }
        
        .layer-features {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .feature-tag {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        /* Connection Lines using SVG */
        .connections {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .connection-line {
            stroke: #34495e;
            stroke-width: 2;
            stroke-dasharray: 5,5;
            fill: none;
            opacity: 0.6;
        }
        
        .data-flow-arrow {
            stroke: #3498db;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead);
        }
        
        .exception-flow-arrow {
            stroke: #e74c3c;
            stroke-width: 3;
            fill: none;
            marker-end: url(#errorhead);
        }
        
        .integration-benefits {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .benefit-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        
        .benefit-title {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .benefit-icon {
            font-size: 20px;
            margin-right: 10px;
        }
        
        .benefit-description {
            color: #7f8c8d;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .legend {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
            border-radius: 10px;
        }
        
        .legend-title {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 13px;
            color: #2c3e50;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        @media (max-width: 1200px) {
            .architecture-container {
                height: 1400px;
                padding: 20px;
            }
            
            .controller-layer,
            .service-layer,
            .repository-layer,
            .infrastructure-layer {
                left: 5%;
                right: 5%;
            }
            
            .controller-layer { top: 20px; height: 80px; }
            .service-layer { top: 120px; height: 100px; }
            .repository-layer { top: 240px; height: 80px; }
            .infrastructure-layer { top: 340px; height: 70px; }
            
            .logging-system {
                top: 430px;
                left: 5%;
                right: 5%;
                width: auto;
                height: 200px;
            }
            
            .async-system {
                top: 650px;
                left: 5%;
                width: 90%;
                height: 140px;
            }
            
            .performance-monitor {
                top: 810px;
                left: 5%;
                width: 90%;
                height: 140px;
            }
            
            .testing-framework {
                top: 970px;
                left: 5%;
                width: 90%;
                height: 140px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .architecture-container {
                height: 1300px;
                padding: 15px;
            }
            
            .controller-layer,
            .service-layer,
            .repository-layer,
            .infrastructure-layer {
                left: 3%;
                right: 3%;
                height: 70px;
            }
            
            .controller-layer { top: 15px; }
            .service-layer { top: 100px; }
            .repository-layer { top: 185px; }
            .infrastructure-layer { top: 270px; }
            
            .logging-system {
                top: 360px;
                left: 3%;
                right: 3%;
                width: auto;
                height: 180px;
            }
            
            .async-system {
                top: 560px;
                left: 3%;
                width: 94%;
                height: 130px;
            }
            
            .performance-monitor {
                top: 710px;
                left: 3%;
                width: 94%;
                height: 130px;
            }
            
            .testing-framework {
                top: 860px;
                left: 3%;
                width: 94%;
                height: 130px;
            }
            
            .layer-title {
                font-size: 16px;
            }
            
            .layer-content {
                font-size: 12px;
            }
            
            .feature-tag {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏗️ 統合エラーハンドリングシステム アーキテクチャ</h1>
        
        <div class="architecture-container">
            <!-- SVG for Connections -->
            <svg class="connections" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                            refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#3498db" />
                    </marker>
                    <marker id="errorhead" markerWidth="10" markerHeight="7" 
                            refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c" />
                    </marker>
                </defs>
                
                <!-- Data Flow Arrows - レイヤー間の正常フロー -->
                <path class="data-flow-arrow" d="M 200 120 L 200 140" />
                <path class="data-flow-arrow" d="M 200 250 L 200 270" />
                <path class="data-flow-arrow" d="M 200 360 L 200 380" />
                
                <!-- Exception Flow Arrows - レイヤー間の例外フロー -->
                <path class="exception-flow-arrow" d="M 300 380 L 300 360" />
                <path class="exception-flow-arrow" d="M 300 270 L 300 250" />
                <path class="exception-flow-arrow" d="M 300 140 L 300 120" />
                
                <!-- Cross-cutting Connections - ログシステムへの接続 -->
                <path class="connection-line" d="M 450 65 L 500 65" />
                <path class="connection-line" d="M 450 185 L 500 150" />
                <path class="connection-line" d="M 450 305 L 500 220" />
                <path class="connection-line" d="M 450 410 L 500 290" />
            </svg>
            
            <!-- Main Architecture Layers -->
            <div class="architecture-layer controller-layer">
                <div class="layer-title">🎮 Controller Layer</div>
                <div class="layer-content">
                    プレゼンテーション層：ユーザー向けエラーメッセージ・HTTPステータス制御
                </div>
                <div class="layer-features">
                    <span class="feature-tag">ユーザビリティ重視</span>
                    <span class="feature-tag">HTTPステータス</span>
                    <span class="feature-tag">レスポンス制御</span>
                </div>
            </div>
            
            <div class="architecture-layer service-layer">
                <div class="layer-title">⚙️ Service Layer</div>
                <div class="layer-content">
                    ビジネスロジック層：例外変換・非同期処理・バリデーション統合
                </div>
                <div class="layer-features">
                    <span class="feature-tag">例外変換</span>
                    <span class="feature-tag">非同期処理</span>
                    <span class="feature-tag">ビジネスルール</span>
                    <span class="feature-tag">高速バリデーション</span>
                </div>
            </div>
            
            <div class="architecture-layer repository-layer">
                <div class="layer-title">📊 Repository Layer</div>
                <div class="layer-content">
                    データアクセス層：技術例外→データ例外変換・接続プール管理
                </div>
                <div class="layer-features">
                    <span class="feature-tag">技術例外変換</span>
                    <span class="feature-tag">接続管理</span>
                    <span class="feature-tag">リトライ制御</span>
                </div>
            </div>
            
            <div class="architecture-layer infrastructure-layer">
                <div class="layer-title">🏛️ Infrastructure Layer</div>
                <div class="layer-content">
                    インフラ層：データベース・外部API・ファイルシステム
                </div>
                <div class="layer-features">
                    <span class="feature-tag">DB接続</span>
                    <span class="feature-tag">外部API</span>
                    <span class="feature-tag">ファイルI/O</span>
                </div>
            </div>
            
            <!-- Cross-cutting Concerns -->
            <div class="logging-system">
                <div class="layer-title">📝 ログ統合システム</div>
                <div class="layer-content">
                    <strong>ログレベル：</strong><br>
                    • INFO: 処理フロー<br>
                    • WARNING: 回復可能<br>
                    • SEVERE: システムエラー<br><br>
                    
                    <strong>出力制御：</strong><br>
                    • コンソール出力<br>
                    • ファイル出力<br>
                    • 集約システム<br><br>
                    
                    <strong>文脈情報：</strong><br>
                    • エラー発生箇所<br>
                    • ユーザーID・時刻<br>
                    • スタックトレース<br><br>
                    
                    <strong>運用連携：</strong><br>
                    • 監視・アラート<br>
                    • 障害分析支援
                </div>
            </div>
            
            <div class="async-system">
                <div class="layer-title">⚡ 非同期通知システム</div>
                <div class="layer-content">
                    <strong>CompletableFuture:</strong><br>
                    • メール送信の非同期実行<br>
                    • SMS通知の並行処理<br>
                    • タイムアウト制御（3秒）<br>
                    • 部分的失敗の許容<br><br>
                    
                    <strong>エラーハンドリング:</strong><br>
                    • exceptionally()で例外処理<br>
                    • 通知失敗時の警告ログ<br>
                    • メイン処理への影響回避
                </div>
            </div>
            
            <div class="performance-monitor">
                <div class="layer-title">📊 パフォーマンス監視</div>
                <div class="layer-content">
                    <strong>最適化技術:</strong><br>
                    • 事前チェックで例外回避<br>
                    • 例外インスタンス再利用<br>
                    • 条件付き詳細例外生成<br><br>
                    
                    <strong>測定項目:</strong><br>
                    • 処理時間（nanoTime）<br>
                    • 例外発生率<br>
                    • メモリ・CPU使用率監視
                </div>
            </div>
            
            <div class="testing-framework">
                <div class="layer-title">🧪 包括的テスト</div>
                <div class="layer-content">
                    <strong>JUnit5テスト:</strong><br>
                    • 正常ケースのテスト<br>
                    • 例外ケースの網羅<br>
                    • assertThrows()で例外検証<br><br>
                    
                    <strong>テストカバレッジ:</strong><br>
                    • 全例外パスの実行<br>
                    • エラーメッセージの検証<br>
                    • モックでの外部依存テスト
                </div>
            </div>
        </div>
        
        <div class="integration-benefits">
            <div class="benefit-card">
                <div class="benefit-title">
                    <span class="benefit-icon">🛡️</span>
                    堅牢性の向上
                </div>
                <div class="benefit-description">
                    レイヤー間の適切な例外変換により、技術的な詳細を上位レイヤーに漏らすことなく、各レイヤーで適切なエラーハンドリングを実現
                </div>
            </div>
            
            <div class="benefit-card">
                <div class="benefit-title">
                    <span class="benefit-icon">🔍</span>
                    可観測性の確保
                </div>
                <div class="benefit-description">
                    統合ログシステムにより、本番環境での問題発生時に迅速な原因特定と対応が可能。レベル別ログ出力で運用効率を向上
                </div>
            </div>
            
            <div class="benefit-card">
                <div class="benefit-title">
                    <span class="benefit-icon">⚡</span>
                    パフォーマンス最適化
                </div>
                <div class="benefit-description">
                    事前チェックによる例外回避、例外の再利用、非同期処理の活用により、高いパフォーマンスと応答性を維持
                </div>
            </div>
            
            <div class="benefit-card">
                <div class="benefit-title">
                    <span class="benefit-icon">🎯</span>
                    ユーザビリティ向上
                </div>
                <div class="benefit-description">
                    Controller層での適切なエラーメッセージ変換により、技術的でないユーザーにも理解しやすいエラー情報を提供
                </div>
            </div>
            
            <div class="benefit-card">
                <div class="benefit-title">
                    <span class="benefit-icon">🔄</span>
                    保守性の確保
                </div>
                <div class="benefit-description">
                    包括的なテストによる品質保証と、明確なレイヤー分離による変更影響の局所化で、長期的な保守性を確保
                </div>
            </div>
            
            <div class="benefit-card">
                <div class="benefit-title">
                    <span class="benefit-icon">📈</span>
                    スケーラビリティ対応
                </div>
                <div class="benefit-description">
                    非同期処理とパフォーマンス監視により、システム負荷の増大に対しても安定した動作を維持
                </div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-title">🎨 システム構成要素の役割</div>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #4CAF50, #45a049);"></div>
                    プレゼンテーション層：ユーザー向けインターフェース
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #2196F3, #1976D2);"></div>
                    ビジネスロジック層：業務ルールと処理制御
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #FF9800, #F57C00);"></div>
                    データアクセス層：永続化データの管理
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2);"></div>
                    インフラストラクチャ層：システム基盤
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #e74c3c, #c0392b);"></div>
                    横断的関心事：ログ・監視・テスト
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #1abc9c, #16a085);"></div>
                    非同期処理：パフォーマンスと応答性
                </div>
            </div>
        </div>
    </div>
</body>
</html>